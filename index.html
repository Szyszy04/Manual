<!DOCTYPE html>
<html lang="pl">

<head>
    <meta author="Wiktor">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Barmański</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
</head>

<body>
    <div id="app">
        <!-- Ekran startowy -->
        <div v-if="currentScreen === 'start'" class="screen">
            <div class="container">
                <h1>Quiz Barmański</h1>
                <p class="subtitle">Wybierz kategorie i sprawdź swoją wiedzę o drinkach!</p>

                <!-- Wybór kategorii alkoholi -->
                <div class="section">
                    <h3>Kategorie Alkoholi</h3>
                    <p class="help-text">Pytania będą dotyczyć tylko wybranych kategorii</p>

                    <div class="alcohol-categories">
                        <label v-for="(category, index) in Object.keys(selectedAlcoholCategories)" :key="category"
                            :for="'alcohol-' + index" class="category-option">
                            <input type="checkbox" :id="'alcohol-' + index"
                                v-model="selectedAlcoholCategories[category]">
                            <span class="category-name">
                                <span>{{ getCategoryEmoji(category) }}</span>
                                {{ category }}
                            </span>
                        </label>
                    </div>

                    <div v-if="hasSelectedAlcoholCategories" class="selected-info">
                        Wybrano: {{ selectedAlcoholCategoriesList.join(', ') }}
                    </div>
                    <div v-else class="warning">
                        Wybierz przynajmniej jedną kategorię alkoholu!
                    </div>
                </div>

                <!-- Wybór trybu quizu -->
                <div class="section">
                    <h3>Tryby Quizu</h3>

                    <div class="quiz-categories">
                        <label for="mode-proportions" class="category-option">
                            <input type="checkbox" id="mode-proportions" v-model="selectedCategories.proportions">
                            <div>
                                <strong>Proporcje</strong>
                                <p class="description">Sprawdź znajomość proporcji składników</p>
                            </div>
                        </label>

                        <label for="mode-review" class="category-option">
                            <input type="checkbox" id="mode-review" v-model="selectedCategories.review">
                            <div>
                                <strong>Składniki</strong>
                                <p class="description">Czy składnik jest w drinku?</p>
                            </div>
                        </label>

                        <label for="mode-vodka" class="category-option">
                            <input type="checkbox" id="mode-vodka" v-model="selectedCategories.vodka">
                            <div>
                                <strong>Wódka</strong>
                                <p class="description">Pytania o ceny i surowce wódek</p>
                            </div>
                        </label>

                        <label for="mode-builder" class="category-option">
                            <input type="checkbox" id="mode-builder" v-model="selectedCategories.builder">
                            <div>
                                <strong>Builder</strong>
                                <p class="description">Zbuduj drink od podstaw</p>
                            </div>
                        </label>
                    </div>

                    <!-- Practice Mode option - only visible when builder is selected -->
                    <div v-if="selectedCategories.builder" class="sub-option practice-mode-option">
                        <label class="practice-toggle">
                            <input type="checkbox" v-model="practiceMode">
                            <span class="practice-label">
                                <strong>Tylko poprawnie</strong> - powtarzaj ten sam drink dopóki go nie skończysz
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Przycisk rozpoczęcia -->
                <div class="actions">
                    <button @click="startQuiz" class="btn btn-primary"
                        :class="{ disabled: !hasSelectedCategories || !hasSelectedAlcoholCategories }"
                        :disabled="!hasSelectedCategories || !hasSelectedAlcoholCategories">
                        Rozpocznij Quiz
                    </button>
                </div>

                <!-- Dodatkowe opcje -->
                <div class="secondary-actions">
                    <button @click="goToLibrary" class="btn btn-secondary">Biblioteka Alkoholi</button>
                    <button @click="goToDrinkLibrary" class="btn btn-secondary">Biblioteka Drinków</button>
                    <button @click="goToIngredientLibrary" class="btn btn-secondary">Biblioteka Składników</button>
                    <button @click="goToDrinkMap" class="btn btn-secondary">Mapa Drinków</button>
                </div>
            </div>
        </div>

        <!-- Ekran mapy drinków - poprawiony z danymi z drink-map.js -->
        <div v-if="currentScreen === 'drink-map'" class="screen">
            <div class="container">
                <h1>Mapa Drinków</h1>
                <p class="subtitle">Podobne drinki pogrupowane według składników</p>

                <div class="drink-map-compact">
                    <div v-for="(group, groupKey) in drinkGroups" :key="groupKey" class="compact-group">
                        <div class="compact-group-header">
                            <h3>{{ group.icon }} {{ group.name }}</h3>
                            <span class="group-count">{{ group.drinks.length }} drinków</span>
                        </div>

                        <div class="compact-drinks-grid">
                            <div v-for="drink in group.drinks" :key="drink.name" class="compact-drink-card">
                                <div class="compact-drink-header">
                                    <h4>{{ drink.name }}</h4>
                                </div>

                                <div class="ingredients-sections">
                                    <!-- Wspólne składniki -->
                                    <div v-if="drink.commonIngredients && drink.commonIngredients.length > 0"
                                        class="ingredients-group">
                                        <div class="ingredients-list">
                                            <div v-for="ingredient in drink.commonIngredients"
                                                :key="'common-' + ingredient" class="ingredient-item common-ingredient">
                                                {{ ingredient }}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Unikalne składniki -->
                                    <div v-if="drink.uniqueIngredients && drink.uniqueIngredients.length > 0"
                                        class="ingredients-group">
                                        <div class="ingredients-list">
                                            <div v-for="ingredient in drink.uniqueIngredients"
                                                :key="'unique-' + ingredient" class="ingredient-item unique-ingredient">
                                                {{ ingredient }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button @click="goToStart" class="btn btn-secondary">Powrót do Menu</button>
                </div>
            </div>
        </div>

        <!-- Ekran quizu -->
        <div v-if="currentScreen === 'quiz'" class="screen quiz-screen">
            <div class="container">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" :style="{ width: progressWidth }"></div>
                    </div>
                    <div class="progress-text">Pytanie {{ currentQuestionIndex + 1 }} z {{ questions.length }}</div>
                </div>

                <div class="question-container">
                    <h2 class="question">{{ currentQuestion.question }}</h2>

                    <!-- Zwykłe odpowiedzi TAK/NIE -->
                    <div v-if="currentQuestion.answers && currentQuestion.answers.length === 2"
                        class="answers-grid simple-answers">
                        <button v-for="(answer, index) in shuffledAnswers" :key="index" @click="answerQuestion(index)"
                            :disabled="answerSelected" :class="['answer-btn', getAnswerClass(index)]">
                            {{ answer }}
                        </button>
                    </div>

                    <!-- Odpowiedzi z recepturami -->
                    <div v-else-if="currentQuestion.answers && currentQuestion.answers.length > 2" class="answers-grid">
                        <button v-for="(answer, index) in shuffledAnswers" :key="index" @click="answerQuestion(index)"
                            :disabled="answerSelected" :class="['answer-btn recipe-option', getAnswerClass(index)]">
                            <div class="recipe">
                                <div v-for="ingredient in answer" :key="ingredient.name" class="ingredient">
                                    <span class="amount">{{ ingredient.amount }} ml</span>
                                    <span class="name">{{ ingredient.name }}</span>
                                </div>
                            </div>
                        </button>
                    </div>

                    <!-- Builder Mode -->
                    <div v-if="currentQuestion.type === 'builder'">
                        <!-- Krok 1: Wybór składników -->
                        <div v-if="builderStep === 1" class="builder-step">
                            <h4>Krok 1: Wybierz składniki dla drinka "{{ currentQuestion.drinkName }}"</h4>
                            <p>Wybrane: {{ selectedIngredientsCount }}</p>

                            <!-- Posortowane składniki według kategorii w kompaktowym layoutcie -->
                            <div class="ingredients-categorized">
                                <div v-for="group in groupedIngredientsForBuilder" :key="group.categoryName"
                                    class="ingredient-group">
                                    <!-- Nagłówek kategorii -->
                                    <div class="ingredient-category-header">
                                        <h5>{{ group.categoryName }}</h5>
                                    </div>

                                    <!-- Grid składników w tej kategorii -->
                                    <div class="ingredient-category-content">
                                        <button v-for="ingredient in group.ingredients" :key="ingredient"
                                            @click="toggleIngredient(ingredient)" class="ingredient-btn"
                                            :class="{ selected: selectedIngredients.has(ingredient) }"
                                            :title="ingredient">
                                            {{ ingredient }}
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <button @click="checkIngredients" class="btn btn-primary">Sprawdź składniki</button>
                        </div>

                        <!-- Krok 2: Proporcje -->
                        <div v-if="builderStep === 2" class="builder-step">
                            <h4>Krok 2: Ustaw proporcje składników</h4>
                            <div class="proportions-input">
                                <div v-for="ingredient in Array.from(selectedIngredients)" :key="ingredient"
                                    class="proportion-item">
                                    <label>{{ ingredient }}</label>
                                    <input type="number" v-model="ingredientAmounts[ingredient]" placeholder="ml">
                                    <span>ml</span>
                                </div>
                            </div>
                            <button @click="checkProportions" class="btn btn-primary">Sprawdź proporcje</button>
                        </div>

                        <!-- Krok 3: Szkło -->
                        <div v-if="builderStep === 3" class="builder-step">
                            <h4>Krok 3: Wybierz odpowiednie szkło</h4>
                            <div class="glasses-grid">
                                <button v-for="glass in shuffledGlassOptions" :key="glass" @click="selectGlass(glass)"
                                    class="glass-btn" :class="{ selected: selectedGlass === glass }">
                                    {{ glass }}
                                </button>
                            </div>
                            <button @click="checkGlass" class="btn btn-primary" :disabled="!selectedGlass">Sprawdź
                                szkło</button>
                        </div>

                        <!-- Komunikaty -->
                        <div v-if="showBuilderRecipe" class="recipe-reveal error">
                            <h4>Błędna odpowiedź!</h4>
                            <div class="correct-recipe">
                                <h4>Poprawna receptura "{{ currentQuestion.drinkName }}"</h4>
                                <div v-for="ingredient in builderCorrectRecipeWithNames" :key="ingredient.name">
                                    <p><strong>{{ ingredient.amount }} ml</strong> {{ ingredient.name }}</p>
                                </div>
                                <p><strong>Szkło:</strong> {{ currentQuestion.correctGlass }}</p>
                                <p><strong>Dekoracja:</strong> {{ currentQuestion.decoration }}</p>
                            </div>
                        </div>

                        <div v-if="showDecorationSuccess" class="success-message">
                            <h4>Brawo! Poprawnie przygotowałeś drinka!</h4>
                            <p>+1 punkt!</p>
                        </div>
                    </div>

                    <!-- Pokazanie receptury po odpowiedzi -->
                    <div v-if="showRecipe" class="recipe-reveal">
                        <h4>Receptura "{{ currentQuestion.drinkName }}"</h4>
                        <div v-for="ingredient in currentRecipe" :key="ingredient.name" class="ingredient">
                            <span class="name">{{ ingredient.name }}</span>
                        </div>
                    </div>

                    <!-- Pokazanie poprawnej proporcji -->
                    <div v-if="showProportionsInfo" class="recipe-reveal">
                        <strong>{{ currentQuestion.correctInfo }}</strong>
                    </div>
                </div>

                <div class="score-info">Wynik: {{ score }}/{{ currentQuestionIndex + 1 }}</div>
            </div>
        </div>

        <!-- Ekran wyników -->
        <div v-if="currentScreen === 'result'" class="screen">
            <div class="container">
                <h1>Wyniki Quizu</h1>

                <div class="final-score">
                    <div class="score-circle">
                        <div>
                            <div class="score">{{ score }}</div>
                            <div class="total">{{ questions.length }}</div>
                        </div>
                    </div>
                    <div class="percentage">{{ Math.round((score / questions.length) * 100) }}%</div>
                </div>

                <div class="score-message">
                    <p v-if="score === questions.length">Perfekcyjny wynik!</p>
                    <p v-else-if="score / questions.length >= 0.8">Świetny wynik!</p>
                    <p v-else-if="score / questions.length >= 0.6">Dobry wynik!</p>
                    <p v-else>Nie poddawaj się!</p>
                </div>

                <div class="actions">
                    <button @click="restartQuiz" class="btn btn-primary">Spróbuj ponownie</button>
                </div>
            </div>
        </div>

        <!-- Biblioteka Alkoholi -->
        <div v-if="currentScreen === 'library'" class="screen">
            <div class="container">
                <h1>Biblioteka Alkoholi</h1>

                <div class="library-navigation">
                    <div class="categories-nav">
                        <button v-for="category in libraryCategories" :key="category"
                            @click="selectLibraryCategory(category)"
                            :class="['category-btn', { active: selectedLibraryCategory === category }]">
                            {{ category }}
                        </button>
                    </div>
                </div>

                <div class="library-content">
                    <div v-for="item in currentLibraryItems" :key="item.name" class="library-item">
                        <h3>{{ item.name }}</h3>
                        <p>{{ item.description }}</p>
                    </div>
                </div>

                <div class="actions">
                    <button @click="goToStart" class="btn btn-secondary">Powrót do menu</button>
                </div>
            </div>
        </div>

        <!-- Biblioteka Drinków -->
        <div v-if="currentScreen === 'drink-library'" class="screen">
            <div class="container">
                <h1>Biblioteka Drinków</h1>

                <div class="library-navigation">
                    <div class="categories-nav">
                        <button v-for="category in drinkCategories" :key="category"
                            @click="selectDrinkCategory(category)"
                            :class="['category-btn', { active: selectedDrinkCategory === category }]">
                            {{ category }}
                        </button>
                    </div>
                </div>

                <div class="drinks-grid">
                    <div v-for="drink in currentDrinkItems" :key="drink.name"
                        :class="['drink-card', { hidden: isDrinkHidden(drink.name) }]"
                        @click="toggleDrinkVisibility(drink.name)">
                        <h3>{{ drink.name }}</h3>
                        <div class="glass-info">{{ drink.glass }}</div>

                        <div v-if="!isDrinkHidden(drink.name)" class="drink-details">
                            <div class="ingredients">
                                <h4>Składniki</h4>
                                <ul>
                                    <li v-for="ingredient in drink.ingredients" :key="ingredient">{{ ingredient }}</li>
                                </ul>
                            </div>

                            <div class="method">
                                <h4>Przygotowanie</h4>
                                <ol>
                                    <li v-for="step in drink.method" :key="step">{{ step }}</li>
                                </ol>
                            </div>

                            <div v-if="drink.decoration" class="decoration">
                                <h4>Dekoracja</h4>
                                <p>{{ drink.decoration }}</p>
                            </div>
                        </div>
                        <div v-else class="hidden-state">
                            Kliknij aby pokazać składniki i przepis
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button @click="goToStart" class="btn btn-secondary">Powrót do menu</button>
                </div>
            </div>
        </div>

        <!-- Biblioteka Składników -->
        <div v-if="currentScreen === 'ingredient-library'" class="screen">
            <div class="container">
                <h1>Biblioteka Składników</h1>

                <div class="library-navigation">
                    <div class="categories-nav">
                        <button v-for="category in ingredientLibraryCategories" :key="category"
                            @click="selectIngredientCategory(category)"
                            :class="['category-btn', { active: selectedIngredientCategory === category }]">
                            {{ category }}
                        </button>
                    </div>
                </div>

                <div class="ingredient-library-content">
                    <div v-for="(details, ingredient) in currentIngredientLibraryItems" :key="ingredient"
                        class="ingredient-category-card">
                        <h3>{{ ingredient }}</h3>
                        <div class="brand-sections">
                            <div class="brand-section">
                                <h4>Manual</h4>
                                <div class="brand-list">
                                    <span v-for="brand in details.manual" :key="brand" class="brand-tag manual">{{ brand
                                        }}</span>
                                </div>
                            </div>
                            <div class="brand-section">
                                <h4>Inne</h4>
                                <div class="brand-list">
                                    <span v-for="brand in details.inne" :key="brand" class="brand-tag other">{{ brand
                                        }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button @click="goToStart" class="btn btn-secondary">Powrót do menu</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>

</html>
